<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì - ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="/css/admin/layout.css">
    <link rel="stylesheet" href="/css/admin/components.css">
    <link rel="stylesheet" href="/css/admin/dashboard.css">
    <link rel="icon" type="image/png" href="/img/logo/favicon.png">
    <style>
        /* ì°¨íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .chart-card {
            background-color: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
            border-radius: 15px;       /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
            padding: 30px;             /* ë‚´ë¶€ ì—¬ë°± */
            margin-top: 30px;          /* ìœ„ìª½ ìš”ì†Œì™€ì˜ ê°„ê²© */
            margin-bottom: 30px;       /* ì•„ë˜ìª½ ìš”ì†Œì™€ì˜ ê°„ê²© */
        }

        .chart-header {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        /* ì•„ì´ì½˜ ë“± ì¥ì‹ìš© (ì„ íƒì‚¬í•­) */
        .chart-header::before {
            content: 'ğŸ“Š';
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>

<aside class="admin-sidebar">
    <div class="sidebar-header">
        <span style="margin-left: 10px;">ğŸ›¡ï¸ SafetyNevi</span>
    </div>
    <ul class="sidebar-menu">
        <li><a href="/admin" class="menu-item active"><span class="icon">ğŸ“Š</span> <span>ëŒ€ì‹œë³´ë“œ</span></a></li>
        <li><a href="/admin/members" class="menu-item"><span class="icon">ğŸ‘¥</span> <span>íšŒì› ê´€ë¦¬</span></a></li>
        <li><a href="/admin/boards" class="menu-item"><span class="icon">ğŸ“</span> <span>ê²Œì‹œë¬¼ ê´€ë¦¬</span></a></li>
        <li><a href="/admin/notice/create" class="menu-item"><span class="icon">ğŸ“¢</span> <span>ê³µì§€ ìƒì„±</span></a></li>
        <li>
            <a href="/admin/inquiries" class="menu-item">
                <span class="icon">ğŸ’Œ</span> <span>ë¬¸ì˜ ê´€ë¦¬</span>
            </a>
        </li>
        <li><a href="/admin/reports" class="menu-item"><span class="icon">ğŸš©</span> <span>ì‹ ê³  ê´€ë¦¬</span></a></li>
        <li><a href="/admin/disaster" class="menu-item"><span class="icon">ğŸš¨</span> <span>ì¬ë‚œ ê´€ë¦¬</span></a></li>
        <li style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
            <a href="/" class="menu-item"><span class="icon">ğŸ </span> <span>ì„œë¹„ìŠ¤ í™ˆ</span></a>
        </li>
    </ul>
</aside>

<main class="admin-content">
    <div class="page-header">
        <div>
            <div class="page-title">ëŒ€ì‹œë³´ë“œ</div>
            <div class="page-subtitle">
                ì˜¤ëŠ˜ ë‚ ì§œ: <span th:text="${#temporals.format(#temporals.createNow(), 'yyyyë…„ MMì›” ddì¼')}"></span>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="stat-card admin-card card-blue">
            <div class="stat-header">
                <span class="stat-title">ì „ì²´ íšŒì› ìˆ˜</span>
                <div class="stat-icon-bg">ğŸ‘¥</div>
            </div>
            <div class="stat-value" th:text="${memberCount}">0</div>
        </div>
        <div class="stat-card admin-card card-green">
            <div class="stat-header">
                <span class="stat-title">ëˆ„ì  ê²Œì‹œê¸€</span>
                <div class="stat-icon-bg">ğŸ“</div>
            </div>
            <div class="stat-value" th:text="${boardCount}">0</div>
        </div>
        <div class="stat-card admin-card card-red">
            <div class="stat-header">
                <span class="stat-title">ë°œíš¨ ì¤‘ì¸ ì¬ë‚œ</span>
                <div class="stat-icon-bg">ğŸš¨</div>
            </div>
            <div class="stat-value" th:text="${disasterCount}">0</div>
        </div>
    </div>

    <div class="chart-card">
        <div class="chart-header">ì§€ì—­ë³„ ê°€ì…ì ë¶„í¬</div>
        <div class="chart-container">
            <canvas id="regionChart"></canvas>
        </div>
    </div>

    <div class="dashboard-section">
        <div class="section-header">ğŸš€ ë¹ ë¥¸ ì‹¤í–‰</div>
        <div class="shortcut-grid">
            <a href="/admin/disaster" class="shortcut-btn">
                <span class="icon">ğŸš¨</span>
                <span>ì¬ë‚œ ìƒí™© ìƒì„±</span>
            </a>
            <a href="/admin/members" class="shortcut-btn">
                <span class="icon">ğŸ‘¥</span>
                <span>íšŒì› ê´€ë¦¬ / íƒˆí‡´</span>
            </a>
            <a href="/map" target="_blank" class="shortcut-btn">
                <span class="icon">ğŸ—ºï¸</span>
                <span>ì§€ë„ ëª¨ë‹ˆí„°ë§</span>
            </a>
        </div>
    </div>

    <div class="dashboard-section">
        <div class="section-header">ğŸ’» ì‹œìŠ¤í…œ ìƒíƒœ</div>
        <div class="system-status-list">
            <div class="status-item">
                <div class="status-dot"></div>
                <div class="status-text">ì„œë²„: <strong>ì •ìƒ ê°€ë™ ì¤‘</strong></div>
            </div>
            <div class="status-item">
                <div class="status-dot"></div>
                <div class="status-text">DB: <strong>Oracle Connected</strong></div>
            </div>
            <div class="status-item">
                <div class="status-dot"></div>
                <div class="status-text">API: <strong>ì—°ë™ ì™„ë£Œ</strong></div>
            </div>
        </div>
    </div>

</main>

</body>

<script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    $(document).ready(function () {
        $.ajax({
            url: '/dashboardChart',
            method: 'POST',
            dataType: 'json',
            success: function (response) {
                // console.log('ëŒ€ì‹œë³´ë“œ ë°ì´í„° :', response); // ë””ë²„ê¹…ìš©

                // 1. í…ìŠ¤íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ (ìƒë‹¨ ì¹´ë“œìš© IDê°€ ìˆë‹¤ë©´ í•´ì œí•´ì„œ ì‚¬ìš©)
                // $('#memberCount').text(response.totalCount);
                // $('#todayMemberCount').text(response.todayCount);

                // 2. ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
                drawRegionChart(response.areaCounts);
            },
            error: function (xhr, status, error) {
                console.error('AJAX ìš”ì²­ ì‹¤íŒ¨:', status, error);
            }
        });
    });

    // ì§€ì—­ë³„ ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜
    function drawRegionChart(areaData) {
        const labels = Object.keys(areaData); // ["ì„œìš¸", "ê²½ê¸°", ...]
        const dataValues = Object.values(areaData); // [10, 5, ...]

        const ctx = document.getElementById('regionChart').getContext('2d');

        // ==========================================
        // ğŸŒŸ [ìˆ˜ì •ë¨] ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì •ì˜
        // ==========================================
        // ë‹¤ì–‘í•œ íŒŒìŠ¤í…”í†¤ ìƒ‰ìƒì„ ë¯¸ë¦¬ ë°°ì—´ë¡œ ì¤€ë¹„í•©ë‹ˆë‹¤.
        // ì§€ì—­ ë°ì´í„° ê°œìˆ˜ê°€ ì´ ìƒ‰ìƒ ê°œìˆ˜ë³´ë‹¤ ë§ìœ¼ë©´ ë‹¤ì‹œ ì²« ë²ˆì§¸ ìƒ‰ìƒë¶€í„° ë°˜ë³µë©ë‹ˆë‹¤.
        const colorPalette = [
            'rgba(255, 99, 132, 0.7)',  // ë¹¨ê°•
            'rgba(54, 162, 235, 0.7)',  // íŒŒë‘
            'rgba(255, 206, 86, 0.7)',  // ë…¸ë‘
            'rgba(75, 192, 192, 0.7)',  // ì²­ë¡
            'rgba(153, 102, 255, 0.7)', // ë³´ë¼
            'rgba(255, 159, 64, 0.7)',  // ì£¼í™©
            'rgba(233, 30, 99, 0.7)',   // í•«í•‘í¬
            'rgba(0, 188, 212, 0.7)',   // í•˜ëŠ˜ìƒ‰
            'rgba(205, 220, 57, 0.7)',  // ë¼ì„ìƒ‰
            'rgba(96, 125, 139, 0.7)',  // ë¸”ë£¨ê·¸ë ˆì´
            'rgba(121, 85, 72, 0.7)'    // ê°ˆìƒ‰
        ];

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: ' ê°€ì…ì ìˆ˜',
                    data: dataValues,
                    // ==========================================
                    // ğŸŒŸ [ìˆ˜ì •ë¨] backgroundColorì— ë°°ì—´ì„ í• ë‹¹
                    // ==========================================
                    backgroundColor: colorPalette,
                    borderRadius: 5, // ë§‰ëŒ€ ë ë‘¥ê¸€ê²Œ
                    barThickness: 'flex', // ë§‰ëŒ€ ë‘ê»˜ ìë™ ì¡°ì ˆ (ë„ˆë¬´ ì–‡ì§€ ì•Šê²Œ)
                    maxBarThickness: 50   // ìµœëŒ€ ë‘ê»˜ ì œí•œ
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // ë²”ë¡€ ìˆ¨ê¹€ (ìƒ‰ì´ ë‹¤ ë‹¤ë¥´ë¯€ë¡œ ë²”ë¡€ê°€ ì§€ì €ë¶„í•´ì§ˆ ìˆ˜ ìˆìŒ)
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 10,
                        cornerRadius: 8,
                        titleFont: { weight: 'bold' }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false, drawBorder: false },
                        ticks: { font: { size: 12 }, color: '#555' }
                    },
                    y: {
                        grid: { display: false, drawBorder: false },
                        ticks: {
                            display: false, // Yì¶• ìˆ«ì ìˆ¨ê¹€ (ê¹”ë”í•˜ê²Œ)
                            beginAtZero: true,
                            stepSize: 1
                        }
                    }
                }
            }
        });
    }
</script>
</html>